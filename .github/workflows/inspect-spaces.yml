name: Inspect Spaces Data

on:
  workflow_dispatch:
    inputs:
      prefix:
        description: 'S3 prefix to inspect'
        required: true
        default: 'trading-system/data/intraday/1min'
        type: string
      folders_only:
        description: 'Show only folders (not individual files)'
        required: false
        default: false
        type: boolean
      num_lines:
        description: 'Number of lines to show from each file'
        required: false
        default: 3
        type: number

jobs:
  inspect:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'
        
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        
    - name: Inspect Spaces objects
      env:
        SPACES_ACCESS_KEY_ID: ${{ secrets.SPACES_ACCESS_KEY_ID }}
        SPACES_SECRET_ACCESS_KEY: ${{ secrets.SPACES_SECRET_ACCESS_KEY }}
        SPACES_BUCKET_NAME: ${{ secrets.SPACES_BUCKET_NAME }}
        SPACES_REGION: ${{ secrets.SPACES_REGION }}
        SPACES_BASE_PREFIX: ${{ vars.SPACES_BASE_PREFIX }}
        DATA_ROOT: ${{ vars.DATA_ROOT }}
        UNIVERSE_KEY: ${{ vars.UNIVERSE_KEY }}
      run: |
        FOLDERS_ONLY_FLAG=""
        if [ "${{ inputs.folders_only }}" = "true" ]; then
          FOLDERS_ONLY_FLAG="--folders-only"
        fi
        
        python -m tools.inspect_spaces --prefix "${{ inputs.prefix }}" \
          $FOLDERS_ONLY_FLAG \
          --num-lines "${{ inputs.num_lines }}"