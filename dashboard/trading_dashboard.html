<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading System Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #e5e7eb;
        }
        .tab-active {
            background-color: #374151;
            color: #ffffff;
            border-bottom-color: #4f46e5;
        }
        .tab-inactive {
            background-color: #1f2937;
            color: #9ca3af;
            border-bottom-color: transparent;
        }
        .table-header { background-color: #1f2937; }
        .table-row-dark { background-color: #374151; }
        .table-row-light { background-color: #1f2937; }
        .long-text { color: #22c55e; }
        .short-text { color: #ef4444; }
        .stat-card { background-color: #1f2937; }
        .btn-log { background-color: #4f46e5; color: white; }
        .btn-log:hover { background-color: #4338ca; }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease;
        }
        .modal-content {
            background-color: #1f2937;
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">

    <div class="max-w-full mx-auto">
        <!-- Header -->
        <header class="mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-white">Trading System Dashboard</h1>
                <p class="text-gray-400" id="last-updated">Last updated: --:--:--</p>
            </div>
            <div class="text-right">
                <p class="font-semibold text-white">Youssef Awwad</p>
            </div>
        </header>

        <!-- Tabs -->
        <div class="mb-6">
            <div class="border-b border-gray-700">
                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                    <button id="tab-trade-plans" class="tab-active whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-lg">
                        Trade Plans
                    </button>
                    <button id="tab-execution" class="tab-inactive whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-lg">
                        Execution Tracker
                    </button>
                    <button id="tab-journal" class="tab-inactive whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-lg">
                        Trade Journal & Performance
                    </button>
                </nav>
            </div>
        </div>

        <!-- Content Panes -->
        <main>
            <!-- Trade Plans Pane -->
            <div id="pane-trade-plans">
                <h2 class="text-xl font-semibold mb-4">Trade Plan Details</h2>
                <div class="overflow-x-auto rounded-lg shadow">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="table-header">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Ticker</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Strategy</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Direction</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Trade Type</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Holding Days</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Tradeable?</th>
                            </tr>
                        </thead>
                        <tbody id="trade-plans-table-body" class="divide-y divide-gray-700"></tbody>
                    </table>
                </div>
            </div>

            <!-- Execution Tracker Pane -->
            <div id="pane-execution" class="hidden">
                <h2 class="text-xl font-semibold mb-4">Execution Tracker</h2>
                <div class="overflow-x-auto rounded-lg shadow">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="table-header">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Ticker</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Direction</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Entry</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Stop Loss</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Target 1 (2R)</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Target 2 (3R)</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Action</th>
                            </tr>
                        </thead>
                        <tbody id="execution-table-body" class="divide-y divide-gray-700"></tbody>
                    </table>
                </div>
            </div>

            <!-- Journal Pane -->
            <div id="pane-journal" class="hidden">
                 <h2 class="text-xl font-semibold mb-4">Performance Report</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="stat-card p-4 rounded-lg shadow"><h3 class="text-sm font-medium text-gray-400">Win Rate</h3><p id="stat-win-rate" class="mt-1 text-3xl font-semibold text-white">0%</p></div>
                    <div class="stat-card p-4 rounded-lg shadow"><h3 class="text-sm font-medium text-gray-400">Total R-Multiple</h3><p id="stat-total-r" class="mt-1 text-3xl font-semibold text-white">0.0 R</p></div>
                    <div class="stat-card p-4 rounded-lg shadow"><h3 class="text-sm font-medium text-gray-400">Average R-Multiple</h3><p id="stat-avg-r" class="mt-1 text-3xl font-semibold text-white">0.0 R</p></div>
                    <div class="stat-card p-4 rounded-lg shadow"><h3 class="text-sm font-medium text-gray-400">Total Trades</h3><p id="stat-total-trades" class="mt-1 text-3xl font-semibold text-white">0</p></div>
                </div>

                <h2 class="text-xl font-semibold mb-4">Trade Log</h2>
                <div class="overflow-x-auto rounded-lg shadow">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="table-header">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Date Opened</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Ticker</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Direction</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Entry Price</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Stop Loss</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Strategy</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">PnL %</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">R-Multiple</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Win?</th>
                            </tr>
                        </thead>
                        <tbody id="journal-table-body" class="divide-y divide-gray-700"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- Configuration ---
        const SIGNALS_PATH = '/content/drive/MyDrive/trading-system/data/signals/trade_signals_signals.csv';
        const EXECUTION_PATH = '/content/drive/MyDrive/trading-system/data/signals/execution_tracker_signals.csv';
        const JOURNAL_PATH = '/content/drive/MyDrive/trading-system/journal/trade_log.csv';
        const REFRESH_INTERVAL = 30000; // 30 seconds

        // --- Tab Switching Logic ---
        const tabs = [
            { btn: document.getElementById('tab-trade-plans'), pane: document.getElementById('pane-trade-plans') },
            { btn: document.getElementById('tab-execution'), pane: document.getElementById('pane-execution') },
            { btn: document.getElementById('tab-journal'), pane: document.getElementById('pane-journal') }
        ];

        tabs.forEach(tab => {
            tab.btn.addEventListener('click', () => {
                tabs.forEach(t => {
                    t.btn.classList.replace('tab-active', 'tab-inactive');
                    t.pane.classList.add('hidden');
                });
                tab.btn.classList.replace('tab-inactive', 'tab-active');
                tab.pane.classList.remove('hidden');
            });
        });

        // --- Live Data Fetching & Parsing ---
        async function fetchCSV(filePath) {
            try {
                const response = await fetch(filePath);
                if (!response.ok) {
                    console.error(`Failed to fetch ${filePath}: ${response.statusText}`);
                    return [];
                }
                const text = await response.text();
                return parseCSV(text);
            } catch (error) {
                console.error(`Error fetching or parsing ${filePath}:`, error);
                return [];
            }
        }

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            if (lines.length < 2) return [];
            const header = lines[0].split(',').map(h => h.trim());
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                header.forEach((h, i) => {
                    obj[h] = values[i] ? values[i].trim() : '';
                });
                return obj;
            });
        }

        // --- Data Rendering ---
        function renderTable(tableBodyId, data, rowRenderer) {
            const tableBody = document.getElementById(tableBodyId);
            if (!tableBody) return;
            tableBody.innerHTML = '';
            if (data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="100%" class="text-center py-8 text-gray-500">No data available.</td></tr>`;
                return;
            }
            data.forEach((item, index) => {
                tableBody.innerHTML += rowRenderer(item, index);
            });
        }

        function renderTradePlans(signals) {
            renderTable('trade-plans-table-body', signals, (signal, index) => {
                const rowClass = index % 2 === 0 ? 'table-row-dark' : 'table-row-light';
                const directionClass = signal.Direction === 'Long' ? 'long-text' : 'short-text';
                return `
                    <tr class="${rowClass}">
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-white">${signal.Ticker}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${signal.Strategy}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold ${directionClass}">${signal.Direction}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${signal['Trade Type']}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${signal['Holding Days']}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold ${signal['Tradeable?'] === 'TRUE' ? 'long-text' : 'short-text'}">${signal['Tradeable?']}</td>
                    </tr>`;
            });
        }

        function renderExecutionTracker(signals) {
             renderTable('execution-table-body', signals, (signal, index) => {
                const rowClass = index % 2 === 0 ? 'table-row-dark' : 'table-row-light';
                const directionClass = signal.Direction === 'Long' ? 'long-text' : 'short-text';
                return `
                    <tr class="${rowClass}">
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-white">${signal.Ticker}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold ${directionClass}">${signal.Direction}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${signal.Entry}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${signal['Stop Loss']}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${signal['Target 1 (2R)']}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${signal['Target 2 (3R)']}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-medium"><button class="btn-log px-3 py-1 rounded-md text-xs">Log Trade</button></td>
                    </tr>`;
            });
        }

        function renderJournal(journal) {
            renderTable('journal-table-body', journal, (trade, index) => {
                const rowClass = index % 2 === 0 ? 'table-row-dark' : 'table-row-light';
                const pnlClass = parseFloat(trade['R-Multiple']) > 0 ? 'long-text' : 'short-text';
                return `
                    <tr class="${rowClass}">
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${trade['Date Opened']}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-white">${trade.Ticker}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold ${trade.Direction === 'Long' ? 'long-text' : 'short-text'}">${trade.Direction}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${trade['Entry Price']}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${trade['Stop Loss']}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">${trade.Strategy}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold ${pnlClass}">${trade['PnL %']}%</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold ${pnlClass}">${trade['R-Multiple']} R</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold ${pnlClass}">${trade['Win?']}</td>
                    </tr>`;
            });
        }
        
        function calculatePerformance(journal) {
            if (journal.length === 0) return;
            const totalTrades = journal.length;
            const winningTrades = journal.filter(t => parseFloat(t['R-Multiple']) > 0).length;
            const totalR = journal.reduce((sum, t) => sum + parseFloat(t['R-Multiple']), 0);
            const winRate = (winningTrades / totalTrades) * 100;
            const avgR = totalR / totalTrades;
            document.getElementById('stat-win-rate').textContent = `${winRate.toFixed(1)}%`;
            document.getElementById('stat-total-r').textContent = `${totalR.toFixed(1)} R`;
            document.getElementById('stat-avg-r').textContent = `${avgR.toFixed(1)} R`;
            document.getElementById('stat-total-trades').textContent = totalTrades;
        }

        // --- Main Application Logic ---
        async function updateDashboard() {
            console.log("Fetching live data...");
            const [tradePlans, executionData, journalData] = await Promise.all([
                fetchCSV(SIGNALS_PATH),
                fetchCSV(EXECUTION_PATH),
                fetchCSV(JOURNAL_PATH)
            ]);

            renderTradePlans(tradePlans);
            renderExecutionTracker(executionData);
            renderJournal(journalData);
            calculatePerformance(journalData);
            
            document.getElementById('last-updated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }

        // --- Initial Load & Refresh Interval ---
        document.addEventListener('DOMContentLoaded', () => {
            updateDashboard(); // Initial load
            setInterval(updateDashboard, REFRESH_INTERVAL); // Refresh every 30 seconds
        });

    </script>
</body>
</html>
