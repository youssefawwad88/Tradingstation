<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screener Analysis Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #e5e7eb;
        }
        .tab-active {
            background-color: #374151;
            color: #ffffff;
            border-bottom-color: #4f46e5;
        }
        .tab-inactive {
            background-color: #1f2937;
            color: #9ca3af;
            border-bottom-color: transparent;
        }
        .table-header { background-color: #1f2937; }
        .table-row-dark { background-color: #374151; }
        .table-row-light { background-color: #1f2937; }
        .long-text, .positive-value, .status-yes { color: #22c55e; }
        .short-text, .negative-value, .status-no { color: #ef4444; }
        .valid-true { background-color: rgba(34, 197, 94, 0.1); }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">

    <div class="max-w-full mx-auto">
        <!-- Header -->
        <header class="mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-white">Screener Analysis Dashboard</h1>
                <p class="text-gray-400" id="last-updated">Last updated: --:--:--</p>
            </div>
             <div class="text-right">
                <p class="font-semibold text-white">Youssef Awwad</p>
            </div>
        </header>

        <!-- Tabs -->
        <div class="mb-6">
            <div class="border-b border-gray-700">
                <nav id="tabs-container" class="-mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
                    <!-- Tabs will be dynamically generated here -->
                </nav>
            </div>
        </div>

        <!-- Content Panes -->
        <main id="panes-container">
            <!-- Panes will be dynamically generated here -->
        </main>
    </div>

    <script>
        // --- Configuration ---
        const SIGNALS_DIR_PATH = '/content/drive/MyDrive/trading-system/data/signals/';
        const REFRESH_INTERVAL = 30000; // 30 seconds
        const SCREENER_FILES = [
            'gapgo_signals.csv', 'orb_signals.csv', 'avwap_signals.csv',
            'breakout_signals.csv', 'ema_pullback_signals.csv', 'exhaustion_signals.csv',
            'opportunities_today_signals.csv'
        ];

        // --- Live Data Fetching & Parsing ---
        // This part is now handled by the Python launcher script
        
        // --- Dynamic UI Generation ---
        function createTabsAndPanes(screenerFiles) {
            const tabsContainer = document.getElementById('tabs-container');
            const panesContainer = document.getElementById('panes-container');
            tabsContainer.innerHTML = '';
            panesContainer.innerHTML = '';

            screenerFiles.forEach((fileName, index) => {
                const screenerName = fileName.replace('_signals.csv', '').replace(/_/g, ' ').replace('opportunities today', 'Opportunities');
                const tabId = `tab-${screenerName.toLowerCase().replace(/ /g, '-')}`;
                const paneId = `pane-${screenerName.toLowerCase().replace(/ /g, '-')}`;

                const tabButton = document.createElement('button');
                tabButton.id = tabId;
                tabButton.className = index === 0 ? 'tab-active whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-lg' : 'tab-inactive whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-lg';
                tabButton.textContent = screenerName.charAt(0).toUpperCase() + screenerName.slice(1);
                tabsContainer.appendChild(tabButton);

                const paneDiv = document.createElement('div');
                paneDiv.id = paneId;
                paneDiv.className = index === 0 ? '' : 'hidden';
                paneDiv.innerHTML = `
                    <h2 class="text-xl font-semibold mb-4">${screenerName.charAt(0).toUpperCase() + screenerName.slice(1)} Signals</h2>
                    <div class="overflow-x-auto rounded-lg shadow">
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead class="table-header" id="header-${paneId}"></thead>
                            <tbody id="body-${paneId}" class="divide-y divide-gray-700"></tbody>
                        </table>
                    </div>
                `;
                panesContainer.appendChild(paneDiv);

                tabButton.addEventListener('click', () => {
                    document.querySelectorAll('[id^="tab-"]').forEach(t => t.classList.replace('tab-active', 'tab-inactive'));
                    document.querySelectorAll('[id^="pane-"]').forEach(p => p.classList.add('hidden'));
                    tabButton.classList.replace('tab-inactive', 'tab-active');
                    paneDiv.classList.remove('hidden');
                });
            });
        }

        // --- Data Rendering ---
        function renderScreenerData(paneId, data) {
            const headerContainer = document.getElementById(`header-${paneId}`);
            const bodyContainer = document.getElementById(`body-${paneId}`);
            if (!headerContainer || !bodyContainer) return;

            headerContainer.innerHTML = '';
            bodyContainer.innerHTML = '';

            if (!data || data.length === 0) {
                bodyContainer.innerHTML = `<tr><td colspan="100%" class="text-center py-8 text-gray-500">No data available for this screener.</td></tr>`;
                return;
            }

            const headers = Object.keys(data[0]);
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.className = 'px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider';
                th.textContent = header.replace(/_/g, ' ');
                headerRow.appendChild(th);
            });
            headerContainer.appendChild(headerRow);

            data.forEach((row, index) => {
                const rowClass = index % 2 === 0 ? 'table-row-dark' : 'table-row-light';
                const tr = document.createElement('tr');
                tr.className = rowClass;
                
                if(row['Setup Valid?'] === 'TRUE') {
                    tr.classList.add('valid-true');
                }

                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.className = 'px-4 py-4 whitespace-nowrap text-sm text-gray-300';
                    let content = row[header];
                    
                    // --- NEW: Color Coding Logic ---
                    const numericContent = parseFloat(content);
                    if (!isNaN(numericContent)) {
                        if (header.includes('%') || header.includes('Score')) {
                            if (numericContent > 0) td.classList.add('positive-value', 'font-semibold');
                            if (numericContent < 0) td.classList.add('negative-value', 'font-semibold');
                        }
                    } else {
                         if (content === 'Yes' || content === 'TRUE' || content === 'Long') {
                            td.classList.add('positive-value', 'font-semibold');
                         }
                         if (content === 'No' || content === 'FALSE' || content === 'Short') {
                            td.classList.add('negative-value', 'font-semibold');
                         }
                    }
                    
                    td.textContent = content;
                    tr.appendChild(td);
                });
                bodyContainer.appendChild(tr);
            });
        }

        // --- Main Application Logic ---
        function initializeDashboard(screenerFiles, liveData) {
            console.log("Initializing dashboard with injected data...");
            createTabsAndPanes(screenerFiles);
            
            for (const fileName of screenerFiles) {
                const screenerKey = fileName.replace('.csv', '');
                const screenerName = fileName.replace('_signals.csv', '').replace(/_/g, ' ').replace('opportunities today', 'Opportunities');
                const paneId = `pane-${screenerName.toLowerCase().replace(/ /g, '-')}`;
                
                const data = liveData[screenerKey] || [];
                renderScreenerData(paneId, data);
            }
            document.getElementById('last-updated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }
    </script>
</body>
</html>
